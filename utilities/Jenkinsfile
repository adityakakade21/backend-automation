pipeline
{
    agent
	{
        dockerfile
		{
        filename 'Dockerfile'
        dir 'utilities'
        }
    }
    stages
	{
        stage('Checkout')
		{
            steps
			{
                checkout scmGit(branches: [[name: '*/master']], extensions: [], userRemoteConfigs: [[url: 'https://github.com/adityakakade21/backend-automation.git']])
            }
		}
        stage('log version info')
		{
            steps
			{
                sh 'python --version'
            }
		}
        stage('Test')
		{
            steps
			{
                git 'https://github.com/adityakakade21/backend-automation.git'
                sh 'behave'
            }
        }


    }
	post
		{

			stage('Report generation')
		  {
            steps
			{
                sh 'behave --junit --junit-directory JunitReports'
            }
          }
		    stage('Test Results')
		  {
		    steps
			{
			  	realtimeJUnit(keepLongStdio: true, parseInterval: 1, testResults: 'JunitReports/*.xml')
		       {
                  echo 'Test Results'
               }
			}
		  }

			always {
			         archiveArtifacts artifacts: 'AllureRepoers/', followSymlinks: false
			         archiveArtifacts artifacts: 'JunitReports/', followSymlinks: false

                   }

        }
}